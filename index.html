<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Bakiye Hesaplama</title>
  <style>
    body {
      width: 100%;
      height: 100vh;
      font-family: "Segoe UI", sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding: 0;
      user-select: none;
    }
    header {
      background-color: #1f1f1f;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      color: #4caf50;
      border-bottom: 2px solid #333;
    }
    #nakitContainer {
      background-color: #1a1a1a;
      text-align: center;
      padding: 10px;
      border-bottom: 1px solid #333;
    }
    #nakitContainer input {
      width: 150px;
      padding: 8px;
      background-color: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      border-radius: 5px;
      text-align: right;
      font-size: 16px;
    }
    #nakitContainer label {
      margin-right: 10px;
      font-weight: bold;
      color: #4caf50;
    }
    #sonSatisContainer {
      margin-top: 8px;
      color: #bbb;
    }
    #sonSatisContainer label {
      color: #4caf50;
      font-weight: bold;
    }
    #sonSatisContainer button {
      margin-left: 10px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 4px 8px;
      cursor: pointer;
    }
    #sonSatisContainer button:hover {
      background-color: #666;
    }
    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      background-color: #1a1a1a;
      border-bottom: 1px solid #333;
    }
    nav a {
      color: #bbb;
      text-decoration: none;
      padding: 14px 20px;
      display: block;
      transition: 0.3s;
      font-size: 15px;
    }
    nav a:hover, nav a.active {
      color: #4caf50;
    }
    main {
      padding: 15px;
    }
    .table-container {
      width: 100%;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      min-width: 800px;
    }
    th, td {
      border: 1px solid #333;
      padding: 10px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #222;
    }
    tr:hover {
      background-color: #1f1f1f;
      cursor: pointer;
    }
    #fab {
      width: 60px;
      height: 60px;
      position: fixed;
      bottom: 20px;
      right: 20px;
      border-radius: 100%;
      background-color: #4caf50;
      color: #fff;
      font-size: 36px;
      border: none;
      cursor: pointer;
      box-sizing: border-box;
      float: left;
      text-align: center;
      line-height: 55px;
    }
    #fab:hover {
      background-color: #66bb6a;
    }
    #panel {
      position: fixed;
      bottom: -450px;
      left: 0;
      width: 100%;
      background-color: #1c1c1c;
      padding: 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      transition: bottom 0.4s;
    }
    #panel.active {
      bottom: 0;
    }
    input, button {
      font-family: inherit;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      background-color: #2a2a2a;
      color: white;
      border: 1px solid #444;
      border-radius: 5px;
    }
    button {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #66bb6a;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #1f1f1f;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 280px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .modal-content h3 {
      margin-top: 0;
      color: #4caf50;
    }
    .modal-content button {
      display: block;
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
    }
    .cancel-btn {
      background-color: #444;
    }
    .cancel-btn:hover {
      background-color: #666;
    }
  </style>
</head>
<body>

  <header>Bakiye Hesaplama</header>

  <div id="nakitContainer">
    <label for="mevcutNakit">Mevcut Nakit:</label>
    <input type="number" id="mevcutNakit" placeholder="0.00">
  </div>

  <div id="sonSatisContainer">
    <label>Son SatÄ±ÅŸ Nakiti:</label>
    <span id="sonSatisNakit">-</span>
    <button id="temizleSonSatis">Sil</button>
  </div>

  <nav>
    <a href="#" id="linkHome" class="active">Anasayfa</a>
    <a href="#" id="linkCompleted">Tamamlanan Ä°ÅŸlemler</a>
    <a href="#" id="linkBackup">Verileri Yedekle</a>
    <a href="#" id="linkLoad">Verileri YÃ¼kle</a>
  </nav>

  <main>
    <section id="homePage">
      <div class="table-container">
        <table id="dataTable">
          <thead>
            <tr>
              <th>Sembol</th>
              <th>Miktar</th>
              <th>AlÄ±ÅŸ FiyatÄ±</th>
              <th>Komisyon</th>
              <th>Toplam Ã–deme</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="completedPage" style="display:none;">
      <div class="table-container">
        <table id="completedTable">
          <thead>
            <tr>
              <th>Sembol</th>
              <th>Miktar</th>
              <th>AlÄ±ÅŸ FiyatÄ±</th>
              <th>SatÄ±ÅŸ FiyatÄ±</th>
              <th>Toplam (Komisyon)</th>
              <th>Net KÃ¢r/Zarar</th>
              <th>ROI (%)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="backupPage" style="display:none;">
      <h3>Verileri Yedekle</h3>
      <p>TÃ¼m veriler <strong>Hesap_DATA.json</strong> dosyasÄ± olarak indirilecektir.</p>
      <button id="downloadBackup">Yedek DosyasÄ±nÄ± Ä°ndir</button>
    </section>

    <section id="loadPage" style="display:none;">
      <h3>Verileri YÃ¼kle</h3>
      <p>Ã–nceden indirdiÄŸiniz <strong>Hesap_DATA.json</strong> dosyasÄ±nÄ± seÃ§in.</p>
      <input style="width: 90%;" type="file" id="uploadBackup" accept=".json">
    </section>
  </main>

  <div id="fab">+</div>

  <div id="panel">
    <input type="text" id="hisse" placeholder="Sembol">
    <input type="number" id="miktar" placeholder="Miktar">
    <input type="number" id="alis" placeholder="AlÄ±ÅŸ FiyatÄ±">
    <input type="number" id="komisyon" placeholder="Ä°ÅŸlem Ãœcreti">
    <button id="olusturBtn">OluÅŸtur</button>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <h3>Ä°ÅŸlem SeÃ§in</h3>
      <button id="editBtn">DÃ¼zenle</button>
      <button id="completeBtn">Tamamla</button>
      <button class="cancel-btn" id="cancelBtn">Ä°ptal</button>
    </div>
  </div>

  <script>
    const fab = document.getElementById('fab');
    const panel = document.getElementById('panel');
    const dataTable = document.querySelector('#dataTable tbody');
    const completedTable = document.querySelector('#completedTable tbody');
    const modal = document.getElementById('modal');
    const editBtn = document.getElementById('editBtn');
    const completeBtn = document.getElementById('completeBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const nakitInput = document.getElementById('mevcutNakit');
    const sonSatisNakitSpan = document.getElementById('sonSatisNakit');
    const temizleSonSatisBtn = document.getElementById('temizleSonSatis');

    let islemler = JSON.parse(localStorage.getItem('islemler')) || [];
    let tamamlanan = JSON.parse(localStorage.getItem('tamamlanan')) || [];
    let mevcutNakit = parseFloat(localStorage.getItem('mevcutNakit')) || 0;
    let secilenIndex = null;
    let sonSatisNakit = parseFloat(localStorage.getItem('sonSatisNakit')) || null;

    nakitInput.value = mevcutNakit.toFixed(2);
    if (sonSatisNakit !== null) sonSatisNakitSpan.textContent = sonSatisNakit.toFixed(2);

    nakitInput.addEventListener('input', () => {
      mevcutNakit = parseFloat(nakitInput.value) || 0;
      localStorage.setItem('mevcutNakit', mevcutNakit);
    });

    temizleSonSatisBtn.onclick = () => {
      if (confirm("Son satÄ±ÅŸ nakiti bilgisini silmek istiyor musunuz?")) {
        sonSatisNakit = null;
        localStorage.removeItem('sonSatisNakit');
        sonSatisNakitSpan.textContent = "-";
      }
    };

    function kaydet() {
      localStorage.setItem('islemler', JSON.stringify(islemler));
      localStorage.setItem('tamamlanan', JSON.stringify(tamamlanan));
    }

    function tabloGuncelle() {
      dataTable.innerHTML = '';
      islemler.forEach((i, index) => {
        const toplam = i.miktar * i.alis + i.komisyon;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i.hisse}</td>
          <td>${i.miktar}</td>
          <td>${i.alis}</td>
          <td>${i.komisyon.toFixed(2)}</td>
          <td>${toplam.toFixed(2)}</td>
        `;
        tr.onclick = () => acModal(index);
        dataTable.appendChild(tr);
      });
    }

    function tamamlananGuncelle() {
      completedTable.innerHTML = '';
      tamamlanan.forEach((i, index) => {
        const renk = i.net >= 0 ? 'style="color:#4caf50;font-weight:bold;"' : 'style="color:#ff5252;font-weight:bold;"';
        const toplamAlis = i.miktar * i.alis;
        const roi = ((i.net / toplamAlis) * 100).toFixed(2);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i.hisse}</td>
          <td>${i.miktar}</td>
          <td>${i.alis}</td>
          <td>${i.satis}</td>
          <td>${i.toplamKomisyon.toFixed(2)}</td>
          <td ${renk}>${i.net.toFixed(2)}</td>
          <td>${roi}%</td>
        `;
        tr.onclick = () => {
          if (confirm(`${i.hisse} iÅŸlemini silmek istiyor musunuz?`)) {
            tamamlanan.splice(index, 1);
            kaydet();
            tamamlananGuncelle();
          }
        };
        completedTable.appendChild(tr);
      });
    }

    function acModal(index) {
      secilenIndex = index;
      modal.style.display = "flex";
    }
    cancelBtn.onclick = () => modal.style.display = "none";

    editBtn.onclick = () => {
      const i = islemler[secilenIndex];
      i.hisse = prompt('Sembol:', i.hisse);
      i.miktar = parseFloat(prompt('Miktar:', i.miktar));
      i.alis = parseFloat(prompt('AlÄ±ÅŸ fiyatÄ±:', i.alis));
      i.komisyon = parseFloat(prompt('Komisyon:', i.komisyon));
      kaydet();
      tabloGuncelle();
      modal.style.display = "none";
    };

    completeBtn.onclick = () => {
  const i = islemler[secilenIndex];
  const satisAdet = parseFloat(prompt(`SatÄ±ÅŸ adedi (max ${i.miktar}):`));
  if (isNaN(satisAdet) || satisAdet <= 0) return alert("GeÃ§erli bir adet girin!");
  if (satisAdet > i.miktar) return alert("SatÄ±ÅŸ adedi, mevcut adetten fazla olamaz!");

  const satis = parseFloat(prompt('SatÄ±ÅŸ fiyatÄ±:'));
  const satisKomisyon = parseFloat(prompt('SatÄ±ÅŸ komisyonu:'));
  if (isNaN(satis) || isNaN(satisKomisyon)) return alert("GeÃ§erli deÄŸer girilmedi!");

  const oran = satisAdet / i.miktar;
  const alisKismi = i.alis * satisAdet;           // ðŸ”¹ AlÄ±nan kÄ±smÄ±n maliyeti
  const alisKomisyonKismi = i.komisyon * oran;   // ðŸ”¹ AlÄ±ÅŸ komisyonunun satÄ±lan kÄ±sma dÃ¼ÅŸeni
  const toplamKomisyon = alisKomisyonKismi + satisKomisyon;  // ðŸ”¹ Toplam komisyon

  const sonSatisNakitDegeri = (satisAdet * satis) - toplamKomisyon; // ðŸ”¹ Son satÄ±ÅŸ nakiti
  const net = (satisAdet * satis) - alisKismi - toplamKomisyon;      // ðŸ”¹ Net kÃ¢r/zarar

  tamamlanan.push({
    hisse: i.hisse,
    miktar: satisAdet,
    alis: i.alis,
    satis,
    toplamKomisyon,
    net
  });

  i.miktar -= satisAdet;
  i.komisyon -= alisKomisyonKismi;
  if (i.miktar <= 0.000001) islemler.splice(secilenIndex, 1);

  // ðŸ”¹ Son satÄ±ÅŸ nakiti gÃ¼ncelle
  sonSatisNakit = sonSatisNakitDegeri;
  localStorage.setItem('sonSatisNakit', sonSatisNakit);
  sonSatisNakitSpan.textContent = sonSatisNakit.toFixed(2);

  kaydet();
  tabloGuncelle();
  tamamlananGuncelle();
  modal.style.display = "none";
};


    fab.onclick = () => panel.classList.toggle('active');

    document.getElementById('olusturBtn').onclick = () => {
      const hisse = document.getElementById('hisse').value.trim();
      const miktar = parseFloat(document.getElementById('miktar').value);
      const alis = parseFloat(document.getElementById('alis').value);
      const komisyon = parseFloat(document.getElementById('komisyon').value);
      if (!hisse || !miktar || !alis || isNaN(komisyon)) return alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun!');
      islemler.push({ hisse, miktar, alis, komisyon });
      kaydet();
      panel.classList.remove('active');
      document.querySelectorAll('#panel input').forEach(i => i.value = '');
      tabloGuncelle();
    };

    function sayfaGoster(id) {
      document.querySelectorAll('main section').forEach(sec => sec.style.display = 'none');
      document.getElementById(id).style.display = 'block';
      document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
      document.querySelector(`[id=link${id.replace("Page","")}]`).classList.add('active');
    }

    document.getElementById('linkHome').onclick = () => sayfaGoster('homePage');
    document.getElementById('linkCompleted').onclick = () => sayfaGoster('completedPage');
    document.getElementById('linkBackup').onclick = () => sayfaGoster('backupPage');
    document.getElementById('linkLoad').onclick = () => sayfaGoster('loadPage');

    document.getElementById('downloadBackup').onclick = () => {
      const data = { islemler, tamamlanan, mevcutNakit, sonSatisNakit };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'Hesap_DATA.json';
      link.click();
    };

    document.getElementById('uploadBackup').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          islemler = data.islemler || [];
          tamamlanan = data.tamamlanan || [];
          mevcutNakit = data.mevcutNakit || 0;
          nakitInput.value = mevcutNakit.toFixed(2);
          sonSatisNakit = data.sonSatisNakit || null;
          sonSatisNakitSpan.textContent = sonSatisNakit !== null ? sonSatisNakit.toFixed(2) : "-";
          kaydet();
          tabloGuncelle();
          tamamlananGuncelle();
          alert("Veriler baÅŸarÄ±yla yÃ¼klendi!");
        } catch(err) {
          alert("GeÃ§ersiz dosya!");
        }
      };
      reader.readAsText(file);
    });

    tabloGuncelle();
    tamamlananGuncelle();
  </script>
</body>
</html>
